<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merakelysi - Mi Universo Literario</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Playfair+Display:wght@700&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --pink: #f472b6; --pink-light: #fbcfe8;
            --purple: #a855f7; --purple-light: #e9d5ff;
            --blue: #60a5fa; --blue-light: #bfdbfe;
            --green: #10b981; --green-light: #a7f3d0;
            --yellow: #f59e0b; --yellow-light: #fef08a;
            --text-primary: #1f2937; --text-secondary: #4b5563;
            --bg-light: rgba(255, 255, 255, 0.9);
            --border-light: rgba(229, 231, 235, 0.7);
            --font-cursive: 'Caveat', cursive;
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #fdf2f8, #f5f3ff, #ecfdf5); min-height: 100vh; color: var(--text-primary); cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><text y='20' font-size='20'>🦄</text></svg>"), auto; }
        body.modal-open { overflow: hidden; }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; }
        .card { background: var(--bg-light); border-radius: 24px; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); border: 1px solid var(--border-light); cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); text-align: center; }
        .card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .card-icon { font-size: 2rem; margin-bottom: 0.75rem; }
        .card-title { font-size: 1.05rem; font-weight: 600; }
        .btn { background: linear-gradient(135deg, var(--pink), #e879f9); color: white; border: none; padding: 0.8rem 1.6rem; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); }
        .btn.back-btn { background: linear-gradient(135deg, #cbd5e1, #94a3b8); }
        
        .header { text-align: center; margin-bottom: 3rem; padding: 2.5rem 2rem; background: rgba(255, 255, 255, 0.6); border-radius: 24px; box-shadow: 0 16px 32px rgba(0, 0, 0, 0.08); backdrop-filter: blur(12px); }
        .title { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 10vw, 5rem); background: linear-gradient(to right, var(--pink), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .nav-section { display: none; animation: fadeIn 0.5s ease; }
        .nav-section.active { display: block; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .section-title { font-size: 2rem; font-weight: 700; }
        .items-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
        
        .item-card { background: var(--bg-light); border-radius: 16px; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); border: 1px solid var(--border-light); position: relative; display: flex; flex-direction: column; }
        .item-card:hover { transform: translateY(-4px); }
        .item-card.has-image { flex-direction: row; gap: 1.5rem; align-items: flex-start; }
        .item-card-image { width: 100px; height: 150px; object-fit: cover; border-radius: 8px; flex-shrink: 0; }
        .item-content { flex-grow: 1; }
        .item-title { font-size: 1.25rem; }
        .item-subtitle { color: var(--text-secondary); margin-bottom: 0.5rem; }
        .item-meta { color: var(--purple); font-weight: 600; font-size: 0.9rem; }
        .item-notes, .item-link { font-size: 0.9rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed var(--border-light); white-space: pre-wrap; word-break: break-all; }
        .item-actions { margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end; }
        .action-btn { background: #a78bfa; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.8rem; cursor: pointer; }
        .action-btn.action-edit { background-color: var(--blue); }
        .action-btn.action-finish { background-color: var(--green); }
        .action-btn.action-review { background-color: var(--yellow); }
        .delete-btn { position: absolute; top: 0.75rem; right: 0.75rem; background: #fca5a5; color: white; border: none; width: 28px; height: 28px; border-radius: 50%; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; opacity: 0.5; cursor: pointer; }
        .item-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background: var(--red); transform: scale(1.1) rotate(90deg); }

        .modal-backdrop { position: fixed; inset: 0; background-color: rgba(245, 243, 255, 0.5); backdrop-filter: blur(8px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
        .modal-backdrop.active { opacity: 1; visibility: visible; }
        .modal-content { background: linear-gradient(135deg, #ffffff, #f5f3ff); padding: 2.5rem; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); position: relative; max-width: 550px; width: 90%; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.active .modal-content { transform: scale(1); }
        .modal-close-btn { position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.75rem; cursor: pointer; }
        .form-group { margin-bottom: 1rem; }
        .modal-form label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .modal-form input, .modal-form textarea, .modal-form select { width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px; background-color: #f9fafb; }
        .image-preview { width: 100px; height: 150px; object-fit: cover; border-radius: 8px; margin-top: 0.5rem; display: none; }
        
        .book-review-display { background: url('https://www.transparenttextures.com/patterns/paper-fibers.png'), #fffaf4; padding: 2rem; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 10px solid var(--green-light); }
        .review-header { text-align: center; margin-bottom: 2rem; }
        .review-header h2 { font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--green); }
        .review-grid { display: grid; grid-template-columns: 1fr 200px; gap: 2rem; align-items: start; }
        .review-cover { width: 100%; border-radius: 12px; border: 5px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        .review-section { margin-bottom: 2rem; }
        .review-section h3 { font-family: var(--font-cursive); font-size: 2rem; color: var(--purple); border-bottom: 2px dashed var(--purple-light); display: inline-block; margin-bottom: 1rem; }
        .review-section p { background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 12px; line-height: 1.7; white-space: pre-wrap; }
        .rating-display { font-size: 2rem; } .rating-display .filled { color: var(--yellow); }
        .review-actions { margin-top: 2rem; text-align: center; }
        .rating-input { display: flex; flex-direction: row-reverse; justify-content: flex-end; }
        .rating-input input { display: none; }
        .rating-input label { font-size: 2rem; color: #ccc; cursor: pointer; }
        .rating-input label:hover, .rating-input label:hover ~ label, .rating-input input:checked ~ label { color: var(--yellow); }

        #celebration-container { position: fixed; inset: 0; z-index: 3000; pointer-events: none; overflow: hidden; }
        .celebration-message { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 2rem 3rem; background: var(--bg-light); border-radius: 24px; text-align: center; animation: celebrate-fade 4s ease-out; }
        .confetti, .balloon { position: absolute; top: -50px; animation-duration: 4s; animation-iteration-count: infinite; animation-timing-function: linear; }
        .balloon { font-size: 2rem; }
        @keyframes fall { to { transform: translateY(105vh) rotate(720deg); opacity: 0; } }
        @keyframes celebrate-fade { 0%, 100% { opacity: 0; } 20%, 80% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <section id="home" class="nav-section"></section>
        <section id="books" class="nav-section"></section>
        <section id="finished" class="nav-section"></section>
        <section id="clubs" class="nav-section"></section>
        <section id="bookReviews" class="nav-section"></section>
        <section id="playlists" class="nav-section"></section>
        <section id="tributes" class="nav-section"></section>
    </div>

    <div id="modal-container"></div>
    <div id="celebration-container"></div>

    <!-- Plantillas HTML para Modales -->
    <template id="modal-template-book"><div class="modal-backdrop"><div class="modal-content"><button class="modal-close-btn">×</button><h3>Nuevo Libro</h3><form data-section="books"><input type="hidden" name="id"><div class="form-group"><label>Portada</label><input type="file" name="coverImageFile" accept="image/*"><img class="image-preview"></div><div class="form-group"><label>Título</label><input type="text" name="title" required></div><div class="form-group"><label>Autor(a)</label><input type="text" name="author" required></div><div class="form-group"><label>Nº Páginas</label><input type="number" name="pages"></div><div class="form-group"><label>Nº Capítulos</label><input type="number" name="chapters"></div><div class="form-group"><label>Club de Lectura</label><select name="clubId"></select></div><div class="form-group"><label>Meta Semanal</label><input type="text" name="weeklyGoal"></div><button type="submit" class="btn">Guardar</button></form></div></div></template>
    <template id="modal-template-club"><div class="modal-backdrop"><div class="modal-content"><button class="modal-close-btn">×</button><h3>Nuevo Club</h3><form data-section="clubs"><input type="hidden" name="id"><div class="form-group"><label>Nombre</label><input type="text" name="name" required></div><div class="form-group"><label>Días de Reunión</label><input type="text" name="meetingDays"></div><div class="form-group"><label>Metas (Libros/Semana)</label><input type="number" name="weeklyGoal"></div><div class="form-group"><label>Nº Integrantes</label><input type="number" name="memberCount"></div><div class="form-group"><label>Fecha Reunión con Autor</label><input type="date" name="authorMeetingDate"></div><button type="submit" class="btn">Guardar</button></form></div></div></template>
    <template id="modal-template-review"><div class="modal-backdrop"><div class="modal-content"><button class="modal-close-btn">×</button><h3>Mi Reseña</h3><form data-section="reviews"><input type="hidden" name="id"><input type="hidden" name="bookId"><div class="form-group"><label>Calificación</label><div class="rating-input"><input type="radio" id="star5" name="rating" value="5" /><label for="star5">★</label><input type="radio" id="star4" name="rating" value="4" /><label for="star4">★</label><input type="radio" id="star3" name="rating" value="3" /><label for="star3">★</label><input type="radio" id="star2" name="rating" value="2" /><label for="star2">★</label><input type="radio" id="star1" name="rating" value="1" /><label for="star1">★</label></div></div><div class="form-group"><label>Género</label><input type="text" name="genre"></div><div class="form-group"><label>Personajes Favoritos</label><textarea name="favoriteCharacters"></textarea></div><div class="form-group"><label>Lo que más me gustó</label><textarea name="likedMost"></textarea></div><div class="form-group"><label>Aprendizajes</label><textarea name="learnings"></textarea></div><div class="form-group"><label>Frases</label><textarea name="quotes"></textarea></div><div class="form-group"><label>¿Cambiarías el final?</label><input type="text" name="changeFinal"></div><div class="form-group"><label>¿Lo recomendarías?</label><input type="text" name="recommend"></div><button type="submit" class="btn">Guardar</button></form></div></div></template>
    <template id="modal-template-playlist"><div class="modal-backdrop"><div class="modal-content"><button class="modal-close-btn">×</button><h3>Nueva Playlist</h3><form data-section="playlists"><input type="hidden" name="id"><div class="form-group"><label>Título</label><input type="text" name="title" required></div><div class="form-group"><label>Enlace (Spotify, YouTube)</label><input type="url" name="url" required></div><div class="form-group"><label>Vincular a Libro</label><select name="bookId"></select></div><button type="submit" class="btn">Guardar</button></form></div></div></template>
    <template id="modal-template-tribute"><div class="modal-backdrop"><div class="modal-content"><button class="modal-close-btn">×</button><h3>Nuevo Homenaje</h3><form data-section="tributes"><input type="hidden" name="id"><div class="form-group"><label>Título</label><input type="text" name="title" required></div><div class="form-group"><label>Contenido (Enlace, Imagen, Video)</label><input type="text" name="contentUrl" placeholder="Pega aquí el enlace directo..." required></div><div class="form-group"><label>Vincular a Libro</label><select name="bookId"></select></div><button type="submit" class="btn">Guardar</button></form></div></div></template>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIGURACIÓN ---
    const config = {
        storageKey: 'merakelysi_data_v5',
        userNameKey: 'merakelysi_userName_v5',
        sections: [
            { id: 'books', title: 'Mis Libros por Leer', icon: '📚', modal: 'book' },
            { id: 'finished', title: 'Lecturas Terminadas', icon: '✅' },
            { id: 'clubs', title: 'Mis Clubes de Lectura', icon: '👥', modal: 'club' },
            { id: 'bookReviews', title: 'Mis Reseñas', icon: '🖋️' },
            { id: 'playlists', title: 'Playlists Literarias', icon: '🎧', modal: 'playlist' },
            { id: 'tributes', title: 'Homenajes Literarios', icon: '✨', modal: 'tribute' },
        ],
        balloons: ['🎈', '🎉', '🎊']
    };

    // --- ESTADO Y ALMACENAMIENTO ---
    let state = {};
    const storage = {
        save: () => { try { localStorage.setItem(config.storageKey, JSON.stringify(state.db)); } catch (e) { console.error('Error al guardar', e); } },
        load: () => {
            const emptyDB = { books: [], clubs: [], reviews: [], playlists: [], tributes: [] };
            try {
                const data = localStorage.getItem(config.storageKey);
                state.db = data ? JSON.parse(data) : emptyDB;
                // Asegurarse que todos los arrays existan para evitar errores
                Object.keys(emptyDB).forEach(key => {
                    if (!state.db[key]) state.db[key] = [];
                });
            } catch (e) { state.db = emptyDB; }
            state.userName = localStorage.getItem(config.userNameKey) || '';
        }
    };

    // --- LÓGICA PRINCIPAL DE LA APP ---
    const app = {
        init() {
            storage.load();
            this.render('home');
            this.addEventListeners();
            console.log("🦄 Merakelysi App 5.0 - ¡Ahora sí, funcional!");
        },
        addEventListeners() {
            document.body.addEventListener('click', e => {
                const action = e.target.dataset.action;
                if (action && this.actions[action]) {
                    this.actions[action].call(this, e.target);
                }
            });
            document.body.addEventListener('change', e => { if (e.target.id === 'userName') this.actions.saveUserName(e.target); });
            window.addEventListener('beforeunload', storage.save);
        },
        render(sectionId, detailId = null) {
            state.currentSection = sectionId;
            state.detailId = detailId;
            const targetSection = document.getElementById(sectionId);
            document.querySelectorAll('.nav-section').forEach(s => s.classList.remove('active'));
            targetSection.classList.add('active');
            
            const sectionConfig = config.sections.find(s => s.id === sectionId) || { id: 'home' };
            const renderFn = this.renderers[sectionId] || this.renderers.default;
            targetSection.innerHTML = this.renderers.sectionShell(sectionConfig);
            renderFn.call(this, targetSection.querySelector('.content-container'), sectionConfig);
            window.scrollTo(0,0);
        },

        // --- ACCIONES DE USUARIO ---
        actions: {
            navigate(target) { this.render(target.dataset.sectionId); },
            openModal(target) {
                const modalType = target.dataset.modalType;
                const itemId = target.dataset.id;
                const template = document.getElementById(`modal-template-${modalType}`);
                document.getElementById('modal-container').innerHTML = template.innerHTML;

                const form = document.querySelector('#modal-container form');
                if (['book', 'playlist', 'tribute'].includes(modalType)) {
                    const select = form.querySelector('select[name="bookId"]');
                    if (select) {
                        select.innerHTML = '<option value="">-- Opcional --</option>' + state.db.books.map(b => `<option value="${b.id}">${b.title}</option>`).join('');
                    }
                }
                if (modalType === 'review') form.bookId.value = itemId;

                if (itemId && modalType !== 'review') { // Edición
                    const item = state.db[form.dataset.section].find(i => i.id == itemId);
                    Object.keys(item).forEach(key => { if(form[key]) form[key].value = item[key]; });
                    if (item.coverImage) form.querySelector('.image-preview').src = item.coverImage;
                } else if (itemId && modalType === 'review') { // Edición de Reseña
                    const review = state.db.reviews.find(r => r.bookId == itemId);
                    if (review) {
                        Object.keys(review).forEach(key => {
                            if(form[key]) {
                                if(form[key].type === 'radio') form.querySelector(`[name=${key}][value="${review[key]}"]`).checked = true;
                                else form[key].value = review[key];
                            }
                        });
                    }
                }
                document.querySelector('#modal-container .modal-backdrop').classList.add('active');
            },
            closeModal() { document.getElementById('modal-container').innerHTML = ''; },
            deleteItem(target) {
                if (!confirm('¿Estás segura?')) return;
                const section = target.dataset.section;
                const id = target.dataset.id;
                state.db[section] = state.db[section].filter(i => i.id != id);
                this.render(state.currentSection, state.detailId);
            },
            saveForm(form) {
                const section = form.dataset.section;
                const data = Object.fromEntries(new FormData(form).entries());
                const fileInput = form.querySelector('input[type="file"]');

                const saveItem = (imageData = null) => {
                    if (imageData) data.coverImage = imageData;
                    if (data.id) { // Update
                        let item = state.db[section].find(i => i.id == data.id);
                        if(item && !imageData) data.coverImage = item.coverImage; // Keep old image if none new
                        Object.assign(item, data);
                    } else { // Create
                        data.id = Date.now().toString();
                        if (section === 'reviews') { // Handle unique review per book
                           state.db.reviews = state.db.reviews.filter(r => r.bookId !== data.bookId);
                        }
                        state.db[section].push(data);
                    }
                    this.actions.closeModal();
                    if (section === 'reviews') this.render('bookReviews', data.bookId);
                    else this.render(state.currentSection);
                };

                if (fileInput && fileInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = e => saveItem(e.target.result);
                    reader.readAsDataURL(fileInput.files[0]);
                } else {
                    saveItem();
                }
            },
            finishBook(target) {
                const book = state.db.books.find(b => b.id == target.dataset.id);
                if (book && confirm(`¿Marcar "${book.title}" como terminado?`)) {
                    book.isFinished = true;
                    this.render('books');
                    this.renderers.celebration(`¡Felicidades, lograste la meta de leer "${book.title}"!`);
                }
            },
            viewReview(target) { this.render('bookReviews', target.dataset.id); },
            saveUserName(target) { state.userName = target.value; localStorage.setItem(config.userNameKey, state.userName); }
        },

        // --- FUNCIONES DE RENDERIZADO ---
        renderers: {
            sectionShell(sectionConfig) {
                const btnHtml = sectionConfig.modal ? `<button class="btn" data-action="openModal" data-modal-type="${sectionConfig.modal}">+ Nuevo</button>` : '';
                return `<div class="section-header">
                            <button class="btn back-btn" data-action="navigate" data-section-id="home">← Inicio</button>
                            <h2 class="section-title">${sectionConfig.title}</h2>
                            ${btnHtml}
                        </div>
                        <div class="content-container items-grid"></div>`;
            },
            home(container) {
                container.parentElement.innerHTML = `
                    <header class="header">
                        <h1 class="title">Merakelysi</h1>
                        <p>By Maribel Alba</p>
                        <div><label>Hola, </label><input type="text" id="userName" placeholder="tu nombre" value="${state.userName}"></div>
                    </header>
                    <main class="grid">
                        ${config.sections.map(s => `<div class="card" data-action="navigate" data-section-id="${s.id}"><div class="card-icon">${s.icon}</div><h3 class="card-title">${s.title}</h3></div>`).join('')}
                    </main>`;
            },
            default(container, sectionConfig) { container.innerHTML = `<div style="grid-column: 1/-1; text-align: center;"><h3>Sección "${sectionConfig.title}"</h3><p>Aquí aparecerá tu contenido.</p></div>`; },
            books(container) { this.renderers.bookList(container, false); },
            finished(container) { this.renderers.bookList(container, true); },
            bookList(container, isFinished) {
                const books = state.db.books.filter(b => !!b.isFinished === isFinished);
                if (!books.length) return this.renderers.default(container, {});
                container.innerHTML = books.map(book => {
                    const club = state.db.clubs.find(c => c.id == book.clubId);
                    const review = state.db.reviews.find(r => r.bookId == book.id);
                    const finishBtn = `<button class="action-btn action-finish" data-action="finishBook" data-id="${book.id}">✅ Terminar</button>`;
                    const reviewBtn = `<button class="action-btn action-review" data-action="viewReview" data-id="${book.id}">${review ? 'Ver/Editar Reseña' : '✍️ Escribir Reseña'}</button>`;
                    return `<div class="item-card ${book.coverImage ? 'has-image' : ''}">
                        ${book.coverImage ? `<img src="${book.coverImage}" class="item-card-image">` : ''}
                        <div class="item-content">
                            <button class="delete-btn" data-action="deleteItem" data-section="books" data-id="${book.id}">×</button>
                            <h3 class="item-title">${book.title}</h3>
                            <p class="item-subtitle">por ${book.author}</p>
                            <p class="item-meta">${club ? `Club: ${club.name}` : ''}</p>
                            <div class="item-actions">
                                <button class="action-btn action-edit" data-action="openModal" data-modal-type="book" data-id="${book.id}">Editar</button>
                                ${isFinished ? reviewBtn : finishBtn}
                            </div>
                        </div>
                    </div>`;
                }).join('');
            },
            clubs(container) {
                if (!state.db.clubs.length) return this.renderers.default(container, {});
                container.innerHTML = state.db.clubs.map(club => `
                    <div class="item-card">
                        <div class="item-content">
                             <button class="delete-btn" data-action="deleteItem" data-section="clubs" data-id="${club.id}">×</button>
                            <h3 class="item-title">${club.name}</h3>
                            <p class="item-subtitle">${club.memberCount || 0} integrantes</p>
                            <p class="item-notes">Reuniones: ${club.meetingDays || 'N/A'}</p>
                            <div class="item-actions">
                                <button class="action-btn action-edit" data-action="openModal" data-modal-type="club" data-id="${club.id}">Editar</button>
                            </div>
                        </div>
                    </div>`).join('');
            },
            bookReviews(container) {
                const book = state.db.books.find(b => b.id == state.detailId);
                const review = state.db.reviews.find(r => r.bookId == state.detailId);
                if (!book) { container.innerHTML = '<div style="grid-column: 1/-1; text-align: center;"><p>Ve a "Lecturas Terminadas" para escribir o ver una reseña.</p></div>'; return; }
                if (!review) { this.actions.openModal({ dataset: { modalType: 'review', id: book.id } }); return; }

                container.parentElement.querySelector('.section-header .btn').remove(); // No "Nuevo" button here
                container.className = '';
                container.innerHTML = `
                    <div class="book-review-display">
                        <div class="review-header"><h2>Reseña de Libro</h2></div>
                        <div class="review-grid">
                            <div class="review-main-content">
                                <p><strong>Título:</strong> ${book.title}</p>
                                <p><strong>Autor(a):</strong> ${book.author}</p>
                                <div class="review-section"><h3>Lo que más me gustó:</h3><p>${review.likedMost || ''}</p></div>
                                <div class="review-section"><h3>Frases:</h3><p>${review.quotes || ''}</p></div>
                            </div>
                            <div class="review-sidebar">
                                <img src="${book.coverImage || ''}" class="review-cover">
                                <div class="review-section"><h3>Calificación</h3><div class="rating-display">${'★'.repeat(review.rating || 0).padEnd(5, '☆')}</div></div>
                            </div>
                        </div>
                        <div class="review-actions"><button class="btn" data-action="openModal" data-modal-type="review" data-id="${book.id}">Editar Reseña</button></div>
                    </div>`;
            },
            playlists(container) {
                if (!state.db.playlists.length) return this.renderers.default(container, {});
                container.innerHTML = state.db.playlists.map(p => `
                    <div class="item-card">
                         <button class="delete-btn" data-action="deleteItem" data-section="playlists" data-id="${p.id}">×</button>
                        <h3 class="item-title">🎧 ${p.title}</h3>
                        <p class="item-subtitle">Para: ${state.db.books.find(b => b.id == p.bookId)?.title || 'General'}</p>
                        <div class="item-link"><a href="${p.url}" target="_blank" rel="noopener noreferrer">Abrir Playlist</a></div>
                        <div class="item-actions"><button class="action-btn action-edit" data-action="openModal" data-modal-type="playlist" data-id="${p.id}">Editar</button></div>
                    </div>`).join('');
            },
            tributes(container) {
                if (!state.db.tributes.length) return this.renderers.default(container, {});
                container.innerHTML = state.db.tributes.map(t => {
                     const isYT = t.contentUrl.includes('youtube.com') || t.contentUrl.includes('youtu.be');
                     const isImg = /\.(jpeg|jpg|gif|png)$/.test(t.contentUrl);
                     let contentHtml = `<a href="${t.contentUrl}" target="_blank" rel="noopener noreferrer">Ver contenido</a>`;
                     if (isImg) contentHtml = `<img src="${t.contentUrl}" style="max-width:100%; border-radius:8px;">`;
                     // Basic YouTube embed
                     if (isYT) {
                         const videoId = t.contentUrl.split('v=')[1]?.substring(0, 11) || t.contentUrl.split('/').pop();
                         contentHtml = `<iframe width="100%" height="150" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
                     }
                     return `<div class="item-card">
                         <button class="delete-btn" data-action="deleteItem" data-section="tributes" data-id="${t.id}">×</button>
                         <h3 class="item-title">✨ ${t.title}</h3>
                         <p class="item-subtitle">Para: ${state.db.books.find(b => b.id == t.bookId)?.title || 'General'}</p>
                         <div class="item-notes">${contentHtml}</div>
                         <div class="item-actions"><button class="action-btn action-edit" data-action="openModal" data-modal-type="tribute" data-id="${t.id}">Editar</button></div>
                    </div>`;
                }).join('');
            },
            celebration(message) {
                const container = document.getElementById('celebration-container');
                container.innerHTML = `<div class="celebration-message"><h2>${message}</h2></div>`;
                for (let i = 0; i < 70; i++) {
                    const el = document.createElement('div');
                    const isBalloon = Math.random() > 0.8;
                    el.className = isBalloon ? 'balloon' : 'confetti';
                    el.style.left = `${Math.random() * 100}vw`;
                    el.style.animation = `fall ${Math.random() * 2 + 3}s linear infinite`;
                    if(isBalloon) el.textContent = config.balloons[Math.floor(Math.random() * config.balloons.length)];
                    else el.style.background = `hsl(${Math.random() * 360}, 100%, 75%)`;
                    container.appendChild(el);
                }
                setTimeout(() => container.innerHTML = '', 5000);
            }
        }
    };
    
    app.init();
});
</script>
</body>
</html>
